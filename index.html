<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Evolution</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body>
    <script src="app/js/lib/pixi.min.js"></script>
    <script src="app/js/utils.js"></script>
    <script>
        //Aliases
        var Container = PIXI.Container,
            autoDetectRenderer = PIXI.autoDetectRenderer,
            loader = PIXI.loader,
            resources = PIXI.loader.resources,
            TextureCache = PIXI.utils.TextureCache,
            Texture = PIXI.Texture,
            Sprite = PIXI.Sprite;

        //Create a Pixi stage and renderer and add the renderer.view to the DOM
        var stage = new Container(),
            renderer = autoDetectRenderer(512, 512);
        document.body.appendChild(renderer.view);

        //Load a JSON file and run the 'setup' function when it's done
        loader
            .add("/app/img/treasureHunter.json")
            .load(setup);

        //Define variables that might be used in more than one function
        var dungeon, explorer, treasure, door, id;

        function setup() {
            //Create an optional alias called 'id' for all the texture atlas frame id textures
            id = PIXI.loader.resources["/app/img/treasureHunter.json"].textures;

            //There are 3 ways to make sprites from textures atlas frames

            //Dungeon
            dungeon = new Sprite(id["dungeon.png"]);
            stage.addChild(dungeon);

            //Explorer
            explorer = new Sprite(id["explorer.png"]);
            explorer.x = 68;
            //Center the explorer vertically
            explorer.y = stage.height / 2 - explorer.height / 2;
            //Set variables for movement
            explorer.vx = 0;
            explorer.vy = 0;
            explorer.vr = 0;
            stage.addChild(explorer);

            //Treasure
            treasure = new Sprite(id["treasure.png"]);
            treasure.x = stage.width - treasure.width - 48;
            treasure.y = stage.height / 2 - treasure.height / 2;
            stage.addChild(treasure);

            //Exit door
            door = new Sprite(id["door.png"]);
            door.position.set(32, 0);
            stage.addChild(door);

            //Blobs
            var numberOfBlobs = 6,
                spacing = 48,
                xOffset = 150;
            //Make as many blobs as there are 'numberOfBlobs'
            for (var i = 0; i < numberOfBlobs; i++) {

                //Make a blob
                var blob = new Sprite(id["blob.png"]);

                //Space each blob horizontally according to the 'spacing' value.
                //'xOffset' determines the point from the left of the screen
                //at which the first blob should be added.
                var x = spacing * i + xOffset;

                //Give the blob a random y position
                //('randomInt' is a custom function - see below)
                var y = randomInt(0, stage.height - blob.height);

                //Set the blob's position
                blob.x = x;
                blob.y = y;

                //Add the blob sprite to the stage
                stage.addChild(blob);
            }

            //Render the stage   
            renderer.render(stage);

            gameLoop();
        }

        var gameState = play;

        function gameLoop() {
            //Loop this function at 60frames per second
            requestAnimationFrame(gameLoop);

            gameState();

            renderer.render(stage);
        }

        function play() {
            explorer.vx = 1;
            explorer.vy = 0;
            explorer.vr = 0.1;

            explorer.x += explorer.vx;
            explorer.x += explorer.vy;
            explorer.rotation += explorer.vr;
        }
    </script>
</body>

</html>